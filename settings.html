<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Settings â€” JobHuntly</title>

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --sidebar-bg: #f6f6fb;
      --accent: #2f4f9f;
      --muted: #7a7f86;
      --card-border: #e9e9ef;
    }
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:#fff; color:#222; }

    .app-shell { display:grid; grid-template-columns:280px 1fr; min-height:100vh; }
    .sidebar { background:var(--sidebar-bg); padding:28px 20px; border-right:1px solid #ecebf3; display:flex; flex-direction:column; justify-content:space-between; }
    .brand { display:flex; gap:.6rem; align-items:center; }
    .brand img { width:36px; height:36px; object-fit:contain; border-radius:6px; background:#fff; padding:4px; }
    .nav-section .nav-link{ color:#495057; padding:.6rem .5rem; border-radius:8px; margin-bottom:.25rem; display:flex; align-items:center; gap:.6rem;}
    .nav-section .nav-link.active{ background:#eef0ff; color:var(--accent); font-weight:600; }

    .sidebar-bottom { padding-top:16px; border-top:1px solid #ecebf3; display:flex; gap:.8rem; align-items:center; }
    .user-avatar { width:44px; height:44px; border-radius:50%; object-fit:cover; }

    .main { padding:28px 48px; }
    .page-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:18px; }
    .tabs-card { background:#fff; border:1px solid var(--card-border); border-radius:8px; padding:24px; }
    .section-title { font-weight:700; font-size:18px; margin-bottom:6px; }
    .section-sub { color:var(--muted); margin-bottom:18px; }

    /* Profile photo & dropzone row */
    .avatar-large { width:112px; height:112px; border-radius:50%; object-fit:cover; border:1px solid #e6e6ef; background:#fff; }
    .dropzone {
      border:2px dashed #9fb0dc;
      border-radius:8px;
      min-height:112px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:12px;
      color:#2f4f9f;
      background: linear-gradient(90deg, rgba(47,79,159,0.03), rgba(47,79,159,0.00));
    }
    .dropzone.dragover { background: rgba(47,79,159,0.03); border-color:#2f4f9f; }

    .form-left { font-weight:600; margin-bottom:6px; }
    .form-note { color:var(--muted); font-size:13px; margin-bottom:12px; }

    .hr-soft { border-top:1px solid #eef0f6; margin:24px 0; }

    .account-type .form-check { margin-bottom:.6rem; }
    .account-type .muted { display:block; margin-left:28px; margin-top:2px; color: #6f7580; font-size:13px; }

    .btn-accent { background:var(--accent); border-color:var(--accent); color:#fff; }

    .small-muted { color:var(--muted); font-size:13px; }

    @media (max-width:900px){
      .app-shell { grid-template-columns:1fr; }
      .sidebar { order:2; }
      .main { order:1; padding:18px; }
    }
  </style>
</head>
<body>

<div class="app-shell">
  <!-- SIDEBAR (trimmed) -->
  <aside class="sidebar">
    <div>
      <a class="brand text-decoration-none" href="#"><img src="src/images/logo.png" alt="logo"><div><div style="font-weight:700">JobsInArmenia</div><div class="text-muted" style="font-size:12px">Find your next job</div></div></a>

      <nav class="nav flex-column nav-section mt-4">
        <a class="nav-link" href="#"><i class="bi bi-house-door-fill"></i> Dashboard</a>
        <a class="nav-link d-flex justify-content-between align-items-center" href="#"><span><i class="bi bi-chat-dots"></i> Messages</span><span class="badge bg-primary rounded-pill">1</span></a>
        <a class="nav-link" href="#"><i class="bi bi-file-earmark-text"></i> My Applications</a>
        <a class="nav-link" href="#"><i class="bi bi-search"></i> Find Jobs</a>
        <a class="nav-link" href="#"><i class="bi bi-building"></i> Browse Companies</a>
        <a class="nav-link" href="#"><i class="bi bi-person-circle"></i> My Public Profile</a>
        <hr class="my-3">
        <div class="text-muted small mb-2">SETTINGS</div>
        <a class="nav-link active" href="#"><i class="bi bi-gear"></i> Settings</a>
        <a class="nav-link" href="#"><i class="bi bi-question-circle"></i> Help Center</a>
      </nav>
    </div>

    <div class="sidebar-bottom">
      <img class="user-avatar" src="/mnt/data/fcfcaf3d-88b5-427d-a5c5-2e37831937c1.png" alt="user">
      <div>
        <div style="font-weight:700">Jake Gyll</div>
        <div class="text-muted" style="font-size:13px">jakegyll@email.com</div>
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <div class="page-header">
      <div>
        <h1 style="margin:0;font-size:32px;font-weight:800;">Settings</h1>
        <div class="text-muted" style="margin-top:6px">Manage your account information</div>
      </div>
      <div class="d-flex gap-2 align-items-center">
        <a class="btn btn-outline-primary btn-sm" href="#">Back to homepage</a>
        <button class="btn btn-light btn-sm"><i class="bi bi-bell"></i></button>
      </div>
    </div>

    <div class="tabs-card">
      <!-- Tabs -->
      <ul class="nav nav-tabs mb-4" id="settingsTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button">My Profile</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button">Login Details</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="notif-tab" data-bs-toggle="tab" data-bs-target="#notifications" type="button">Notifications</button>
        </li>
      </ul>

      <div class="tab-content">

        <!-- PROFILE TAB -->
        <div class="tab-pane fade show active" id="profile" role="tabpanel" aria-labelledby="profile-tab">
          <div class="section-title">Basic Information</div>
          <div class="section-sub">This is your personal information that you can update anytime.</div>

          <!-- Profile Photo row -->
          <div class="row align-items-center mb-4">
            <div class="col-md-4">
              <div class="form-left">Profile Photo</div>
              <div class="form-note">This image will be shown publicly as your profile picture, it will help recruiters recognize you!</div>
            </div>

            <div class="col-md-8">
              <div class="d-flex align-items-center gap-4">
                <img id="avatarPreview" class="avatar-large" src="/mnt/data/fcfcaf3d-88b5-427d-a5c5-2e37831937c1.png" alt="avatar">
                <div id="dropzone" class="dropzone flex-fill" tabindex="0">
                  <div>
                    <div style="font-weight:600"><i class="bi bi-image"></i> Click to replace</div>
                    <div class="text-muted" style="font-size:13px">or drag and drop</div>
                    <div class="text-muted small mt-1">SVG, PNG, JPG or GIF (max. 400 x 400px)</div>
                    <input id="avatarInput" type="file" accept="image/*" style="display:none" />
                  </div>
                </div>
              </div>
            </div>
          </div>

          <hr class="hr-soft">

          <!-- Personal details form -->
          <form id="profileForm" class="row g-3" novalidate>
            <div class="col-md-4">
              <div class="form-left">Personal Details</div>
            </div>

            <div class="col-md-8">
              <div class="row g-3">
                <div class="col-md-12">
                  <label class="form-label small">Full Name <span class="text-danger">*</span></label>
                  <input id="fullName" name="fullName" class="form-control" placeholder="Jake Gyll" required>
                </div>

                <div class="col-md-6">
                  <label class="form-label small">Phone Number <span class="text-danger">*</span></label>
                  <input id="phone" name="phone" type="tel" class="form-control" placeholder="+44 1245 572 135" required>
                </div>

                <div class="col-md-6">
                  <label class="form-label small">Email <span class="text-danger">*</span></label>
                  <input id="profileEmail" name="profileEmail" type="email" class="form-control" placeholder="Jakegyll@gmail.com" required>
                </div>

                <div class="col-md-6">
                  <label class="form-label small">Date of Birth <span class="text-danger">*</span></label>
                  <div class="input-group">
                    <input id="dob" name="dob" type="date" class="form-control" required>
                    <span class="input-group-text"><i class="bi bi-calendar3"></i></span>
                  </div>
                </div>

                <div class="col-md-6">
                  <label class="form-label small">Gender <span class="text-danger">*</span></label>
                  <select id="gender" name="gender" class="form-select" required>
                    <option value="">Select</option>
                    <option>Male</option>
                    <option>Female</option>
                    <option>Other</option>
                  </select>
                </div>

                <div class="col-md-6">
  <label class="form-label small">Account Type</label>

  <div class="d-flex gap-3">
    <label class="btn btn-outline-secondary p-3 d-flex flex-column align-items-start" style="min-width:220px; border-radius:8px; cursor:pointer;">
      <input class="form-check-input" type="radio" name="accountType" id="typeJobSeeker" value="jobseeker" autocomplete="off" style="margin-right:8px;">
      <div style="font-weight:600;">Job Seeker</div>
      <div class="text-muted small">Looking for a job</div>
    </label>

    <label class="btn btn-outline-secondary p-3 d-flex flex-column align-items-start" style="min-width:220px; border-radius:8px; cursor:pointer;">
      <input class="form-check-input" type="radio" name="accountType" id="typeEmployer" value="employer" autocomplete="off" style="margin-right:8px;">
      <div style="font-weight:600;">Employer</div>
      <div class="text-muted small">Hiring, sourcing candidates</div>
    </label>
  </div>
</div>


              </div>
            </div>

            <div class="col-12">
              <hr class="hr-soft">
            </div>

            <!-- Save area -->
            <div class="col-md-4"></div>
            <div class="col-md-8 d-flex justify-content-end align-items-center gap-2">
              <button type="button" id="revertProfileBtn" class="btn btn-outline-secondary" disabled>Revert</button>
              <button type="submit" id="saveProfileBtn" class="btn btn-accent" disabled>Save changes</button>
            </div>
          </form>
        </div>

        <!-- LOGIN DETAILS TAB -->
        <div class="tab-pane fade" id="login" role="tabpanel" aria-labelledby="login-tab">
          <div class="section-title">Login Details</div>
          <div class="section-sub">This is login information that you can update anytime.</div>

          <!-- Update Email -->
          <div class="row align-items-start mb-4">
            <div class="col-md-4">
              <div class="form-left">Update Email</div>
              <div class="form-note">Update your email address to make sure it is safe</div>
            </div>

            <div class="col-md-8">
              <div class="d-flex align-items-center mb-2">
                <div class="me-3"><strong class="d-block" id="currentEmailText">jakegyll@email.com</strong><span class="small-muted">Your email address is verified.</span></div>
              </div>

              <form id="emailForm" class="row g-3">
                <div class="col-md-8">
                  <label class="form-label small">Update Email</label>
                  <input id="newEmail" type="email" class="form-control" placeholder="Enter your new email">
                  <div id="emailHelp" class="small-muted mt-1"></div>
                </div>
                <div class="col-auto d-flex align-items-end">
                  <button type="submit" id="updateEmailBtn" class="btn btn-accent" disabled>Update Email</button>
                </div>
              </form>
            </div>
          </div>

          <hr class="hr-soft">

          <!-- Change Password -->
          <div class="row align-items-start">
            <div class="col-md-4">
              <div class="form-left">New Password</div>
              <div class="form-note">Manage your password to make sure it is safe</div>
            </div>

            <div class="col-md-8">
              <form id="passwordForm" class="row g-3">
                <div class="col-12">
                  <label class="form-label small">Old Password</label>
                  <input id="oldPassword" type="password" class="form-control" placeholder="Enter your old password">
                </div>

                <div class="col-12">
                  <label class="form-label small">New Password</label>
                  <input id="newPassword" type="password" class="form-control" placeholder="Enter your new password">
                  <div class="small-muted mt-1">Minimum 8 characters</div>
                </div>

                <div class="col-12 d-flex justify-content-end">
                  <button type="submit" id="changePassBtn" class="btn btn-accent" disabled>Change Password</button>
                </div>
              </form>
            </div>
          </div>

        </div>
      </div>
    </div>

  </main>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ========= MOCK SAVED STATE ========= */
const savedProfile = {
  fullName: 'Jake Gyll',
  phone: '+44 1245 572 135',
  email: 'jakegyll@email.com',
  dob: '1997-08-09',
  gender: 'Male',
  accountType: 'jobseeker',
  avatarSrc: '/mnt/data/fcfcaf3d-88b5-427d-a5c5-2e37831937c1.png'
};

const savedLogin = {
  email: savedProfile.email
};

/* ========= PROFILE TAB LOGIC ========= */
const profileForm = document.getElementById('profileForm');
const profileFields = ['fullName','phone','dob','gender'];
const accountTypeEl = document.getElementById('accountType');

const avatarPreview = document.getElementById('avatarPreview');
const avatarInput = document.getElementById('avatarInput');
const dropzone = document.getElementById('dropzone');

const saveProfileBtn = document.getElementById('saveProfileBtn');
const revertProfileBtn = document.getElementById('revertProfileBtn');

let lastSavedProfile = {...savedProfile};
let avatarChanged = false;
let avatarFile = null;

function populateProfileUI(){
  document.getElementById('fullName').value = lastSavedProfile.fullName || '';
  document.getElementById('phone').value = lastSavedProfile.phone || '';
  document.getElementById('profileEmail').value = lastSavedProfile.email || '';
  document.getElementById('dob').value = lastSavedProfile.dob || '';
  document.getElementById('gender').value = lastSavedProfile.gender || '';
  accountTypeEl.value = lastSavedProfile.accountType || 'jobseeker';
  avatarPreview.src = lastSavedProfile.avatarSrc || '';
  avatarInput.value = '';
  avatarChanged = false;
  avatarFile = null;
  updateProfileButtons();
  // Keep login email display in sync if email same
  document.getElementById('currentEmailText').textContent = lastSavedProfile.email;
}
populateProfileUI();

function fieldProfileChanged(name){
  const el = document.getElementById(name);
  if (!el) return false;
  const cur = el.value.trim();
  const saved = (lastSavedProfile[name] || '').trim();
  return cur !== saved;
}
function accountTypeChanged(){
  return accountTypeEl.value !== (lastSavedProfile.accountType || 'jobseeker');
}
function anyProfileChanges(){
  if (avatarChanged) return true;
  if (accountTypeChanged()) return true;
  for (const f of profileFields) if (fieldProfileChanged(f)) return true;
  // email field in profile might differ from login email â€” treat as profile change
  const profileEmail = (document.getElementById('profileEmail').value || '').trim();
  if (profileEmail !== (lastSavedProfile.email || '')) return true;
  return false;
}
function updateProfileButtons(){
  const changed = anyProfileChanges();
  saveProfileBtn.disabled = !changed;
  revertProfileBtn.disabled = !changed;
}

/* avatar drag/drop logic */
function prevent(e){ e.preventDefault(); e.stopPropagation(); }
['dragenter','dragover'].forEach(ev=>{
  dropzone.addEventListener(ev, (e)=>{ prevent(e); dropzone.classList.add('dragover'); });
});
['dragleave','drop'].forEach(ev=>{
  dropzone.addEventListener(ev, (e)=>{ prevent(e); dropzone.classList.remove('dragover'); });
});
dropzone.addEventListener('click', ()=> avatarInput.click());
dropzone.addEventListener('keydown', (e)=>{ if (e.key === 'Enter' || e.key === ' ') avatarInput.click(); });

dropzone.addEventListener('drop', (e)=>{
  const file = e.dataTransfer.files && e.dataTransfer.files[0];
  if (!file) return;
  handleAvatarFile(file);
});
avatarInput.addEventListener('change', (e)=>{
  const file = e.target.files && e.target.files[0];
  if (!file) return;
  handleAvatarFile(file);
});
function handleAvatarFile(file){
  if (!file.type.startsWith('image/')) { alert('Please upload an image file.'); avatarInput.value=''; return; }
  avatarFile = file;
  avatarChanged = true;
  const reader = new FileReader();
  reader.onload = ()=> {
    avatarPreview.src = reader.result;
    updateProfileButtons();
  };
  reader.readAsDataURL(file);
}

/* changes detection on inputs */
[...profileFields, 'profileEmail'].forEach(name=>{
  const el = document.getElementById(name);
  if (el) el.addEventListener('input', updateProfileButtons);
});
accountTypeEl.addEventListener('change', updateProfileButtons);

/* revert */
revertProfileBtn.addEventListener('click', ()=>{
  lastSavedProfile = {...lastSavedProfile}; // no-op but explicit
  populateProfileUI();
});

/* save profile (only changed fields) */
profileForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  if (!anyProfileChanges()) return;

  // basic required check
  const required = ['fullName','phone','profileEmail','dob','gender'];
  for (const r of required){
    const el = document.getElementById(r);
    if (!el || !el.value.trim()){
      alert('Please fill required fields.');
      return;
    }
  }

  const payload = {};
  for (const f of profileFields) if (fieldProfileChanged(f)) payload[f] = document.getElementById(f).value.trim();
  if (accountTypeChanged()) payload.accountType = accountTypeEl.value;
  if (document.getElementById('profileEmail').value.trim() !== (lastSavedProfile.email || '')) {
    payload.email = document.getElementById('profileEmail').value.trim();
  }

  const prevText = saveProfileBtn.textContent;
  saveProfileBtn.textContent = 'Saving...';
  saveProfileBtn.disabled = true;
  revertProfileBtn.disabled = true;

  try {
    // simulate server latency and response
    await new Promise(r=>setTimeout(r, 700));
    const serverResp = {
      success: true,
      updated: {...payload},
      avatarUrl: avatarChanged ? (avatarFile ? URL.createObjectURL(avatarFile) : '') : undefined
    };
    if (!serverResp.success) throw new Error('server error');

    // update lastSavedProfile
    for (const [k,v] of Object.entries(serverResp.updated || {})) {
      lastSavedProfile[k] = v;
    }
    if (avatarChanged) {
      lastSavedProfile.avatarSrc = serverResp.avatarUrl !== undefined ? serverResp.avatarUrl : lastSavedProfile.avatarSrc;
    }

    // reflect state
    populateProfileUI();
    avatarChanged = false;
    avatarFile = null;

    saveProfileBtn.textContent = 'Saved âœ“';
    setTimeout(()=> { saveProfileBtn.textContent = prevText; updateProfileButtons(); }, 1100);

  } catch(err){
    console.error(err);
    alert('Could not save profile â€” try again.');
    saveProfileBtn.textContent = prevText;
    updateProfileButtons();
  }
});

/* ========= LOGIN DETAILS LOGIC ========= */
/* Email update */
const emailForm = document.getElementById('emailForm');
const newEmailInput = document.getElementById('newEmail');
const updateEmailBtn = document.getElementById('updateEmailBtn');
const currentEmailText = document.getElementById('currentEmailText');

newEmailInput.addEventListener('input', ()=>{
  const val = newEmailInput.value.trim();
  updateEmailBtn.disabled = (val === '' || val === savedLogin.email);
});

/* submit email update */
emailForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const newEmail = newEmailInput.value.trim();
  if (!newEmail) return;
  // basic email format check
  if (!/^\S+@\S+\.\S+$/.test(newEmail)) { alert('Enter a valid email.'); return; }

  const prevText = updateEmailBtn.textContent;
  updateEmailBtn.textContent = 'Saving...';
  updateEmailBtn.disabled = true;

  try {
    await new Promise(r=>setTimeout(r, 700));
    // simulate server success
    savedLogin.email = newEmail;
    // Also update profile saved email if desired â€” keep both consistent
    lastSavedProfile.email = newEmail;
    populateProfileUI();
    currentEmailText.textContent = newEmail;

    updateEmailBtn.textContent = 'Saved âœ“';
    setTimeout(()=>{ updateEmailBtn.textContent = prevText; newEmailInput.value=''; updateEmailBtn.disabled=true; }, 1000);
  } catch(err){
    console.error(err);
    alert('Could not update email.');
    updateEmailBtn.textContent = prevText;
    updateEmailBtn.disabled = false;
  }
});

/* Password change logic */
const passwordForm = document.getElementById('passwordForm');
const oldPassword = document.getElementById('oldPassword');
const newPassword = document.getElementById('newPassword');
const changePassBtn = document.getElementById('changePassBtn');

function updatePassBtnState(){
  const oldVal = (oldPassword.value || '').trim();
  const newVal = (newPassword.value || '').trim();
  changePassBtn.disabled = !(oldVal.length > 0 && newVal.length >= 8);
}
oldPassword.addEventListener('input', updatePassBtnState);
newPassword.addEventListener('input', updatePassBtnState);

passwordForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const oldVal = oldPassword.value.trim();
  const newVal = newPassword.value.trim();
  if (!oldVal || newVal.length < 8) return alert('Please provide the old password and a new password with at least 8 characters.');

  const prevText = changePassBtn.textContent;
  changePassBtn.textContent = 'Saving...';
  changePassBtn.disabled = true;

  try {
    await new Promise(r=>setTimeout(r, 700));
    // simulate success
    changePassBtn.textContent = 'Saved âœ“';
    oldPassword.value = '';
    newPassword.value = '';
    setTimeout(()=>{ changePassBtn.textContent = prevText; changePassBtn.disabled = true; }, 1000);
  } catch(err){
    console.error(err);
    alert('Could not change password.');
    changePassBtn.textContent = prevText;
    updatePassBtnState();
  }
});

/* keep login email display in sync if profile changes email */
document.getElementById('profileEmail').addEventListener('input', () => {
  // do nothing here; changes to profile email are saved via Profile Save; after that populateProfileUI updates currentEmailText
});

/* initialize button states */
updateProfileButtons();
updatePassBtnState();
updateEmailBtn.disabled = true;

</script>
</body>
</html>
